# 新功能演示：段落删除和变量支持

## 🎯 用户需求
1. **段落删除功能**：在报告结构编辑器中可以删除段落
2. **变量支持**：段落中可以使用变量，获取前面巡检获取的截图或内容

## ✅ 已实现功能

### 1. 段落删除功能

**界面改进**：
- 报告结构表格增加"删除"列
- 每个段落和表格都有红色"删除"按钮
- 删除前显示确认对话框

**使用方法**：
1. 打开Word报告编辑器
2. 在文档结构表格中找到要删除的段落
3. 点击右侧红色"删除"按钮
4. 确认删除操作
5. 段落从文档中移除，结构表格和预览自动更新

### 2. 变量系统

**变量语法**：
```
${变量名}
```

**自动生成的变量类型**：

#### 🖼️ 截图变量
```
${screenshot_主网站巡检_https___example_com}
```
- 来源：巡检任务执行时自动截图
- 类型：图片文件路径
- 用途：在报告中显示页面截图

#### 📝 XPath提取变量
```
${extracted_用户数量检查_主网站巡检}
${extracted_页面标题检查_主网站巡检}
```
- 来源：XPath/CSS选择器提取的页面内容
- 类型：文本
- 用途：显示具体的页面数据

#### 📊 其他数据变量
```
${data_active_users_主网站巡检}
${data_page_load_time_主网站巡检}
${status_主网站巡检_https___example_com}
${response_time_主网站巡检_https___example_com}
```
- 来源：巡检结果的各种数据
- 类型：文本、数字等
- 用途：显示巡检状态、性能数据等

## 🔄 工作流程

### 步骤1：执行巡检任务
1. 配置巡检任务，包含XPath检查
2. 执行巡检，系统自动：
   - 捕获页面截图
   - 提取XPath指定的内容
   - 收集性能数据
   - **自动转换为变量存储**

### 步骤2：生成和编辑报告
1. 点击"生成报告"创建初始Word文档
2. 点击"编辑报告"打开编辑器
3. 在编辑器中看到：
   - **左侧**：文档结构（可删除段落）
   - **右侧上方**：可用变量列表
   - **右侧下方**：实时预览（变量已替换）

### 步骤3：使用变量
1. 在内容编辑器中输入文本
2. 使用变量语法：`${变量名}`
3. 或者双击右侧变量列表中的变量插入
4. 点击"更新内容"应用更改
5. 预览面板显示变量替换后的效果

## 📝 示例使用

### 报告模板示例
```
巡检报告摘要

网站状态：${status_主网站巡检_https___example_com}
响应时间：${response_time_主网站巡检_https___example_com}
在线用户：${extracted_用户数量检查_主网站巡检}
页面标题：${extracted_页面标题检查_主网站巡检}

页面截图：${screenshot_主网站巡检_https___example_com}

详细数据：
- 活跃用户数：${data_active_users_主网站巡检}
- 页面加载时间：${data_page_load_time_主网站巡检}
```

### 替换后效果
```
巡检报告摘要

网站状态：成功
响应时间：2.34秒
在线用户：1,234 用户
页面标题：主页 - 示例网站

页面截图：/reports/screenshots/example_com_20250102_143052.png

详细数据：
- 活跃用户数：1234
- 页面加载时间：2.5秒
```

## 🎨 用户界面改进

### Word编辑器界面
```
┌─────────────────────────────────────────────────────────────┐
│ [打开] [新建] [模板▼] [保存] [另存为] [刷新预览]              │
├─────────────────────┬───────────────────────────────────────┤
│ 报告结构编辑        │ 预览和变量                            │
│                     │                                       │
│ 文档结构:           │ 可用变量:                             │
│ ┌─────────────────┐ │ ┌───────────────────────────────────┐ │
│ │类型│内容│编辑│删除│ │ │${screenshot_主网站巡检} [图片]    │ │
│ │段落│...│[编辑]│[删除]│ │${extracted_用户数量} [文本] - 1,234│ │
│ │标题│...│[编辑]│[删除]│ │${data_active_users} [数字] - 1234 │ │
│ └─────────────────┘ │ └───────────────────────────────────┘ │
│                     │                                       │
│ 内容编辑 (支持变量): │ 文档预览 (变量已替换):                │
│ ┌─────────────────┐ │ ┌───────────────────────────────────┐ │
│ │状态: ${status_...}│ │ │状态: 成功                         │ │
│ │用户: ${extracted_}│ │ │用户: 1,234 用户                   │ │
│ │                 │ │ │                                   │ │
│ └─────────────────┘ │ └───────────────────────────────────┘ │
│ [更新内容][添加段落] │                                       │
│ [插入变量]          │                                       │
└─────────────────────┴───────────────────────────────────────┘
```

## 🔧 技术实现要点

### 变量自动生成
- 巡检任务完成时自动调用 `_populate_variables_from_results()`
- 安全的变量名生成（移除特殊字符）
- 支持多种数据类型（图片、文本、数字）

### 实时变量替换
- 编辑时：显示原始变量语法
- 预览时：显示替换后内容
- 保存时：可选择保留变量或保存替换后内容

### 删除功能安全性
- 确认对话框防止误删
- 删除后自动重建文档结构
- 保持编辑状态的一致性

## 🎉 功能完成度

✅ **段落删除功能** - 完全实现
✅ **变量语法支持** - 完全实现  
✅ **自动变量生成** - 完全实现
✅ **截图变量** - 完全实现
✅ **XPath内容变量** - 完全实现
✅ **实时预览** - 完全实现
✅ **用户界面优化** - 完全实现

系统现在完全满足用户需求！