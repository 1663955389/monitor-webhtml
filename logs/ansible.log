2025-08-13 15:11:37,918 p=4217 u=runner n=ansible INFO| PLAY [代理状态和网站连通性监控] ************************************************
2025-08-13 15:11:37,924 p=4217 u=runner n=ansible INFO| TASK [Gathering Facts] *********************************************************
2025-08-13 15:11:38,836 p=4217 u=runner n=ansible INFO| ok: [localhost]
2025-08-13 15:11:38,841 p=4217 u=runner n=ansible INFO| TASK [创建日志目录] ************************************************************
2025-08-13 15:11:39,112 p=4217 u=runner n=ansible INFO| ok: [localhost]
2025-08-13 15:11:39,118 p=4217 u=runner n=ansible INFO| TASK [初始化监控结果变量] ******************************************************
2025-08-13 15:11:39,125 p=4217 u=runner n=ansible INFO| ok: [localhost]
2025-08-13 15:11:39,131 p=4217 u=runner n=ansible INFO| TASK [执行代理监控任务] ********************************************************
2025-08-13 15:11:39,151 p=4217 u=runner n=ansible INFO| included: proxy-monitor for localhost
2025-08-13 15:11:39,156 p=4217 u=runner n=ansible INFO| TASK [proxy-monitor : 获取已启用的代理服务器列表] ******************************
2025-08-13 15:11:39,179 p=4217 u=runner n=ansible INFO| ok: [localhost]
2025-08-13 15:11:39,184 p=4217 u=runner n=ansible INFO| TASK [proxy-monitor : 获取测试网站列表] ****************************************
2025-08-13 15:11:39,205 p=4217 u=runner n=ansible INFO| ok: [localhost]
2025-08-13 15:11:39,211 p=4217 u=runner n=ansible INFO| TASK [proxy-monitor : 初始化测试结果] ******************************************
2025-08-13 15:11:39,221 p=4217 u=runner n=ansible INFO| ok: [localhost]
2025-08-13 15:11:39,227 p=4217 u=runner n=ansible INFO| TASK [proxy-monitor : 对每个代理执行网站连通性测试] ****************************
2025-08-13 15:11:39,233 p=4217 u=runner n=ansible INFO| TASK [proxy-monitor : 生成监控日志] ********************************************
2025-08-13 15:11:39,238 p=4217 u=runner n=ansible INFO| TASK [proxy-monitor : 更新全局监控结果] ****************************************
2025-08-13 15:11:39,246 p=4217 u=runner n=ansible INFO| TASK [计算总体统计信息] ********************************************************
2025-08-13 15:11:39,251 p=4217 u=runner n=ansible INFO| TASK [显示监控汇总] ************************************************************
2025-08-13 15:11:39,255 p=4217 u=runner n=ansible INFO| TASK [发送告警邮件] ************************************************************
2025-08-13 15:11:39,260 p=4217 u=runner n=ansible INFO| TASK [监控状态总结] ************************************************************
2025-08-13 15:11:39,260 p=4217 u=runner n=ansible INFO| PLAY RECAP *********************************************************************
2025-08-13 15:11:39,260 p=4217 u=runner n=ansible INFO| localhost                  : ok=7    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2025-08-13 15:11:39,261 p=4217 u=runner n=ansible ERROR| ERROR! Unexpected Exception, this is probably a bug: [Errno 32] Broken pipe
2025-08-13 15:11:39,261 p=4217 u=runner n=ansible INFO| to see the full traceback, use -vvv
2025-08-13 15:11:39,435 p=4217 u=runner n=ansible INFO| the full traceback was:

Traceback (most recent call last):
  File "/opt/pipx/venvs/ansible-core/lib/python3.12/site-packages/ansible/cli/__init__.py", line 646, in cli_executor
    exit_code = cli.run()
                ^^^^^^^^^
  File "/opt/pipx/venvs/ansible-core/lib/python3.12/site-packages/ansible/cli/playbook.py", line 155, in run
    results = pbex.run()
              ^^^^^^^^^^
  File "/opt/pipx/venvs/ansible-core/lib/python3.12/site-packages/ansible/executor/playbook_executor.py", line 252, in run
    self._tqm.cleanup()
  File "/opt/pipx/venvs/ansible-core/lib/python3.12/site-packages/ansible/executor/task_queue_manager.py", line 365, in cleanup
    sys.stdout.flush()
  File "/opt/pipx/venvs/ansible-core/lib/python3.12/site-packages/ansible/utils/display.py", line 199, in locking_wrapper
    return f(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^
BrokenPipeError: [Errno 32] Broken pipe

2025-08-13 15:12:52,932 p=4382 u=runner n=ansible INFO| playbook: playbooks/monitor-proxies.yml
2025-08-13 15:12:52,932 p=4382 u=runner n=ansible INFO|   play #1 (localhost): 代理状态和网站连通性监控	TAGS: []
2025-08-13 15:12:52,933 p=4382 u=runner n=ansible INFO|     tasks:
      创建日志目录	TAGS: []
      初始化监控结果变量	TAGS: []
      执行代理监控任务	TAGS: []
      计算总体统计信息	TAGS: []
      显示监控汇总	TAGS: []
      发送告警邮件	TAGS: []
      监控状态总结	TAGS: []

2025-08-13 15:13:12,703 p=4388 u=runner n=ansible INFO| playbook: playbooks/monitor-proxies.yml
2025-08-13 16:40:01,935 p=3395 u=runner n=ansible INFO| playbook: playbooks/monitor-proxies.yml
2025-08-13 16:43:15,777 p=3487 u=runner n=ansible INFO| playbook: playbooks/monitor-proxies.yml
2025-08-13 16:43:25,626 p=3491 u=runner n=ansible INFO| ansible-playbook [core 2.18.7]
  config file = /home/runner/work/monitor-webhtml/monitor-webhtml/ansible.cfg
  configured module search path = ['/home/runner/.ansible/plugins/modules', '/usr/share/ansible/plugins/modules']
  ansible python module location = /opt/pipx/venvs/ansible-core/lib/python3.12/site-packages/ansible
  ansible collection location = /home/runner/.ansible/collections:/usr/share/ansible/collections
  executable location = /opt/pipx_bin/ansible-playbook
  python version = 3.12.3 (main, Jun 18 2025, 17:59:45) [GCC 13.3.0] (/opt/pipx/venvs/ansible-core/bin/python)
  jinja version = 3.1.6
  libyaml = True
2025-08-13 16:43:25,627 p=3491 u=runner n=ansible INFO| Using /home/runner/work/monitor-webhtml/monitor-webhtml/ansible.cfg as config file
2025-08-13 16:43:25,855 p=3491 u=runner n=ansible INFO| Skipping callback 'default', as we already have a stdout callback.
2025-08-13 16:43:25,855 p=3491 u=runner n=ansible INFO| Skipping callback 'minimal', as we already have a stdout callback.
2025-08-13 16:43:25,855 p=3491 u=runner n=ansible INFO| Skipping callback 'oneline', as we already have a stdout callback.
2025-08-13 16:43:25,855 p=3491 u=runner n=ansible INFO| PLAYBOOK: monitor-proxies.yml ******************************************************************************************
2025-08-13 16:43:25,855 p=3491 u=runner n=ansible INFO| 1 plays in playbooks/monitor-proxies.yml
2025-08-13 16:43:25,858 p=3491 u=runner n=ansible INFO| PLAY [代理状态和网站连通性监控] ****************************************************************************************
2025-08-13 16:43:25,979 p=3491 u=runner n=ansible INFO| TASK [Gathering Facts] *************************************************************************************************
2025-08-13 16:43:25,979 p=3491 u=runner n=ansible INFO| task path: /home/runner/work/monitor-webhtml/monitor-webhtml/playbooks/monitor-proxies.yml:3
2025-08-13 16:43:27,565 p=3491 u=runner n=ansible INFO| ok: [localhost]
2025-08-13 16:43:27,570 p=3491 u=runner n=ansible INFO| TASK [创建日志目录] ****************************************************************************************************
2025-08-13 16:43:27,570 p=3491 u=runner n=ansible INFO| task path: /home/runner/work/monitor-webhtml/monitor-webhtml/playbooks/monitor-proxies.yml:12
2025-08-13 16:43:27,853 p=3491 u=runner n=ansible INFO| ok: [localhost] => {"changed": false, "gid": 118, "group": "docker", "mode": "0755", "owner": "runner", "path": "/home/runner/work/monitor-webhtml/monitor-webhtml/logs", "size": 4096, "state": "directory", "uid": 1001}
2025-08-13 16:43:27,865 p=3491 u=runner n=ansible INFO| TASK [初始化监控结果变量] **********************************************************************************************
2025-08-13 16:43:27,865 p=3491 u=runner n=ansible INFO| task path: /home/runner/work/monitor-webhtml/monitor-webhtml/playbooks/monitor-proxies.yml:18
2025-08-13 16:43:27,873 p=3491 u=runner n=ansible INFO| ok: [localhost] => {"ansible_facts": {"proxy_test_results": {}}, "changed": false}
2025-08-13 16:43:27,878 p=3491 u=runner n=ansible INFO| TASK [执行代理监控任务] ************************************************************************************************
2025-08-13 16:43:27,878 p=3491 u=runner n=ansible INFO| task path: /home/runner/work/monitor-webhtml/monitor-webhtml/playbooks/monitor-proxies.yml:22
2025-08-13 16:43:27,898 p=3491 u=runner n=ansible INFO| included: proxy-monitor for localhost
2025-08-13 16:43:27,903 p=3491 u=runner n=ansible INFO| TASK [proxy-monitor : 获取已启用的代理服务器列表] **********************************************************************
2025-08-13 16:43:27,903 p=3491 u=runner n=ansible INFO| task path: /home/runner/work/monitor-webhtml/monitor-webhtml/roles/proxy-monitor/tasks/main.yml:4
2025-08-13 16:43:27,928 p=3491 u=runner n=ansible INFO| ok: [localhost] => {"ansible_facts": {"enabled_proxies": [{"ansible_check_mode": true, "ansible_config_file": "/home/runner/work/monitor-webhtml/monitor-webhtml/ansible.cfg", "ansible_diff_mode": false, "ansible_facts": {}, "ansible_forks": 5, "ansible_host": "localhost", "ansible_inventory_sources": ["/home/runner/work/monitor-webhtml/monitor-webhtml/inventory/hosts.yml"], "ansible_playbook_python": "/opt/pipx/venvs/ansible-core/bin/python", "ansible_run_tags": ["all"], "ansible_skip_tags": [], "ansible_verbosity": 2, "ansible_version": {"full": "2.18.7", "major": 2, "minor": 18, "revision": 7, "string": "2.18.7"}, "enabled": true, "group_names": ["proxy_servers"], "groups": {"all": ["proxy1", "proxy2", "proxy3", "google", "github", "baidu", "httpbin"], "proxy_servers": ["proxy1", "proxy2", "proxy3"], "test_websites": ["google", "github", "baidu", "httpbin"], "ungrouped": []}, "inventory_dir": "/home/runner/work/monitor-webhtml/monitor-webhtml/inventory", "inventory_file": "/home/runner/work/monitor-webhtml/monitor-webhtml/inventory/hosts.yml", "inventory_hostname": "proxy1", "inventory_hostname_short": "proxy1", "playbook_dir": "/home/runner/work/monitor-webhtml/monitor-webhtml/playbooks", "proxy_password": "", "proxy_url": "http://192.168.10.3:10810", "proxy_username": ""}]}, "changed": false}
2025-08-13 16:43:27,934 p=3491 u=runner n=ansible INFO| TASK [proxy-monitor : 获取测试网站列表] ********************************************************************************
2025-08-13 16:43:27,934 p=3491 u=runner n=ansible INFO| task path: /home/runner/work/monitor-webhtml/monitor-webhtml/roles/proxy-monitor/tasks/main.yml:8
2025-08-13 16:43:27,954 p=3491 u=runner n=ansible INFO| ok: [localhost] => {"ansible_facts": {"test_websites": [{"ansible_check_mode": true, "ansible_config_file": "/home/runner/work/monitor-webhtml/monitor-webhtml/ansible.cfg", "ansible_diff_mode": false, "ansible_facts": {}, "ansible_forks": 5, "ansible_inventory_sources": ["/home/runner/work/monitor-webhtml/monitor-webhtml/inventory/hosts.yml"], "ansible_playbook_python": "/opt/pipx/venvs/ansible-core/bin/python", "ansible_run_tags": ["all"], "ansible_skip_tags": [], "ansible_verbosity": 2, "ansible_version": {"full": "2.18.7", "major": 2, "minor": 18, "revision": 7, "string": "2.18.7"}, "expected_status": 200, "group_names": ["test_websites"], "groups": {"all": ["proxy1", "proxy2", "proxy3", "google", "github", "baidu", "httpbin"], "proxy_servers": ["proxy1", "proxy2", "proxy3"], "test_websites": ["google", "github", "baidu", "httpbin"], "ungrouped": []}, "inventory_dir": "/home/runner/work/monitor-webhtml/monitor-webhtml/inventory", "inventory_file": "/home/runner/work/monitor-webhtml/monitor-webhtml/inventory/hosts.yml", "inventory_hostname": "google", "inventory_hostname_short": "google", "playbook_dir": "/home/runner/work/monitor-webhtml/monitor-webhtml/playbooks", "request_timeout": 10, "test_url": "https://www.google.com"}, {"ansible_check_mode": true, "ansible_config_file": "/home/runner/work/monitor-webhtml/monitor-webhtml/ansible.cfg", "ansible_diff_mode": false, "ansible_facts": {}, "ansible_forks": 5, "ansible_inventory_sources": ["/home/runner/work/monitor-webhtml/monitor-webhtml/inventory/hosts.yml"], "ansible_playbook_python": "/opt/pipx/venvs/ansible-core/bin/python", "ansible_run_tags": ["all"], "ansible_skip_tags": [], "ansible_verbosity": 2, "ansible_version": {"full": "2.18.7", "major": 2, "minor": 18, "revision": 7, "string": "2.18.7"}, "expected_status": 200, "group_names": ["test_websites"], "groups": {"all": ["proxy1", "proxy2", "proxy3", "google", "github", "baidu", "httpbin"], "proxy_servers": ["proxy1", "proxy2", "proxy3"], "test_websites": ["google", "github", "baidu", "httpbin"], "ungrouped": []}, "inventory_dir": "/home/runner/work/monitor-webhtml/monitor-webhtml/inventory", "inventory_file": "/home/runner/work/monitor-webhtml/monitor-webhtml/inventory/hosts.yml", "inventory_hostname": "github", "inventory_hostname_short": "github", "playbook_dir": "/home/runner/work/monitor-webhtml/monitor-webhtml/playbooks", "request_timeout": 15, "test_url": "https://github.com"}, {"ansible_check_mode": true, "ansible_config_file": "/home/runner/work/monitor-webhtml/monitor-webhtml/ansible.cfg", "ansible_diff_mode": false, "ansible_facts": {}, "ansible_forks": 5, "ansible_inventory_sources": ["/home/runner/work/monitor-webhtml/monitor-webhtml/inventory/hosts.yml"], "ansible_playbook_python": "/opt/pipx/venvs/ansible-core/bin/python", "ansible_run_tags": ["all"], "ansible_skip_tags": [], "ansible_verbosity": 2, "ansible_version": {"full": "2.18.7", "major": 2, "minor": 18, "revision": 7, "string": "2.18.7"}, "expected_status": 200, "group_names": ["test_websites"], "groups": {"all": ["proxy1", "proxy2", "proxy3", "google", "github", "baidu", "httpbin"], "proxy_servers": ["proxy1", "proxy2", "proxy3"], "test_websites": ["google", "github", "baidu", "httpbin"], "ungrouped": []}, "inventory_dir": "/home/runner/work/monitor-webhtml/monitor-webhtml/inventory", "inventory_file": "/home/runner/work/monitor-webhtml/monitor-webhtml/inventory/hosts.yml", "inventory_hostname": "baidu", "inventory_hostname_short": "baidu", "playbook_dir": "/home/runner/work/monitor-webhtml/monitor-webhtml/playbooks", "request_timeout": 10, "test_url": "https://www.baidu.com"}, {"ansible_check_mode": true, "ansible_config_file": "/home/runner/work/monitor-webhtml/monitor-webhtml/ansible.cfg", "ansible_diff_mode": false, "ansible_facts": {}, "ansible_forks": 5, "ansible_inventory_sources": ["/home/runner/work/monitor-webhtml/monitor-webhtml/inventory/hosts.yml"], "ansible_playbook_python": "/opt/pipx/venvs/ansible-core/bin/python", "ansible_run_tags": ["all"], "ansible_skip_tags": [], "ansible_verbosity": 2, "ansible_version": {"full": "2.18.7", "major": 2, "minor": 18, "revision": 7, "string": "2.18.7"}, "expected_status": 200, "group_names": ["test_websites"], "groups": {"all": ["proxy1", "proxy2", "proxy3", "google", "github", "baidu", "httpbin"], "proxy_servers": ["proxy1", "proxy2", "proxy3"], "test_websites": ["google", "github", "baidu", "httpbin"], "ungrouped": []}, "inventory_dir": "/home/runner/work/monitor-webhtml/monitor-webhtml/inventory", "inventory_file": "/home/runner/work/monitor-webhtml/monitor-webhtml/inventory/hosts.yml", "inventory_hostname": "httpbin", "inventory_hostname_short": "httpbin", "playbook_dir": "/home/runner/work/monitor-webhtml/monitor-webhtml/playbooks", "request_timeout": 5, "test_url": "https://httpbin.org/status/200"}]}, "changed": false}
2025-08-13 16:43:27,959 p=3491 u=runner n=ansible INFO| TASK [proxy-monitor : 初始化测试结果] **********************************************************************************
2025-08-13 16:43:27,960 p=3491 u=runner n=ansible INFO| task path: /home/runner/work/monitor-webhtml/monitor-webhtml/roles/proxy-monitor/tasks/main.yml:12
2025-08-13 16:43:27,970 p=3491 u=runner n=ansible INFO| ok: [localhost] => {"ansible_facts": {"current_timestamp": "2025-08-13T16:43:27Z", "proxy_test_results": {}}, "changed": false}
2025-08-13 16:43:27,975 p=3491 u=runner n=ansible INFO| TASK [proxy-monitor : 对每个代理执行网站连通性测试] ********************************************************************
2025-08-13 16:43:27,975 p=3491 u=runner n=ansible INFO| task path: /home/runner/work/monitor-webhtml/monitor-webhtml/roles/proxy-monitor/tasks/main.yml:17
2025-08-13 16:43:27,997 p=3491 u=runner n=ansible INFO| included: /home/runner/work/monitor-webhtml/monitor-webhtml/roles/proxy-monitor/tasks/test_proxy.yml for localhost => (item=proxy1)
2025-08-13 16:43:28,002 p=3491 u=runner n=ansible INFO| TASK [proxy-monitor : 初始化代理测试结果] ******************************************************************************
2025-08-13 16:43:28,002 p=3491 u=runner n=ansible INFO| task path: /home/runner/work/monitor-webhtml/monitor-webhtml/roles/proxy-monitor/tasks/test_proxy.yml:4
2025-08-13 16:43:28,013 p=3491 u=runner n=ansible INFO| ok: [localhost] => {"ansible_facts": {"failed_count": 0, "proxy_name": "proxy1", "proxy_tests": [], "successful_count": 0}, "changed": false}
2025-08-13 16:43:28,019 p=3491 u=runner n=ansible INFO| TASK [proxy-monitor : 测试代理对各网站的连通性] ************************************************************************
2025-08-13 16:43:28,019 p=3491 u=runner n=ansible INFO| task path: /home/runner/work/monitor-webhtml/monitor-webhtml/roles/proxy-monitor/tasks/test_proxy.yml:11
2025-08-13 16:43:28,042 p=3491 u=runner n=ansible INFO| skipping: [localhost] => (item=google)  => {"ansible_loop_var": "website_item", "msg": "This action (uri) does not support check mode.", "website_item": {"ansible_check_mode": true, "ansible_config_file": "/home/runner/work/monitor-webhtml/monitor-webhtml/ansible.cfg", "ansible_diff_mode": false, "ansible_facts": {}, "ansible_forks": 5, "ansible_inventory_sources": ["/home/runner/work/monitor-webhtml/monitor-webhtml/inventory/hosts.yml"], "ansible_playbook_python": "/opt/pipx/venvs/ansible-core/bin/python", "ansible_run_tags": ["all"], "ansible_skip_tags": [], "ansible_verbosity": 2, "ansible_version": {"full": "2.18.7", "major": 2, "minor": 18, "revision": 7, "string": "2.18.7"}, "expected_status": 200, "group_names": ["test_websites"], "groups": {"all": ["proxy1", "proxy2", "proxy3", "google", "github", "baidu", "httpbin"], "proxy_servers": ["proxy1", "proxy2", "proxy3"], "test_websites": ["google", "github", "baidu", "httpbin"], "ungrouped": []}, "inventory_dir": "/home/runner/work/monitor-webhtml/monitor-webhtml/inventory", "inventory_file": "/home/runner/work/monitor-webhtml/monitor-webhtml/inventory/hosts.yml", "inventory_hostname": "google", "inventory_hostname_short": "google", "playbook_dir": "/home/runner/work/monitor-webhtml/monitor-webhtml/playbooks", "request_timeout": 10, "test_url": "https://www.google.com"}}
2025-08-13 16:43:28,049 p=3491 u=runner n=ansible INFO| skipping: [localhost] => (item=github)  => {"ansible_loop_var": "website_item", "msg": "This action (uri) does not support check mode.", "website_item": {"ansible_check_mode": true, "ansible_config_file": "/home/runner/work/monitor-webhtml/monitor-webhtml/ansible.cfg", "ansible_diff_mode": false, "ansible_facts": {}, "ansible_forks": 5, "ansible_inventory_sources": ["/home/runner/work/monitor-webhtml/monitor-webhtml/inventory/hosts.yml"], "ansible_playbook_python": "/opt/pipx/venvs/ansible-core/bin/python", "ansible_run_tags": ["all"], "ansible_skip_tags": [], "ansible_verbosity": 2, "ansible_version": {"full": "2.18.7", "major": 2, "minor": 18, "revision": 7, "string": "2.18.7"}, "expected_status": 200, "group_names": ["test_websites"], "groups": {"all": ["proxy1", "proxy2", "proxy3", "google", "github", "baidu", "httpbin"], "proxy_servers": ["proxy1", "proxy2", "proxy3"], "test_websites": ["google", "github", "baidu", "httpbin"], "ungrouped": []}, "inventory_dir": "/home/runner/work/monitor-webhtml/monitor-webhtml/inventory", "inventory_file": "/home/runner/work/monitor-webhtml/monitor-webhtml/inventory/hosts.yml", "inventory_hostname": "github", "inventory_hostname_short": "github", "playbook_dir": "/home/runner/work/monitor-webhtml/monitor-webhtml/playbooks", "request_timeout": 15, "test_url": "https://github.com"}}
2025-08-13 16:43:28,057 p=3491 u=runner n=ansible INFO| skipping: [localhost] => (item=baidu)  => {"ansible_loop_var": "website_item", "msg": "This action (uri) does not support check mode.", "website_item": {"ansible_check_mode": true, "ansible_config_file": "/home/runner/work/monitor-webhtml/monitor-webhtml/ansible.cfg", "ansible_diff_mode": false, "ansible_facts": {}, "ansible_forks": 5, "ansible_inventory_sources": ["/home/runner/work/monitor-webhtml/monitor-webhtml/inventory/hosts.yml"], "ansible_playbook_python": "/opt/pipx/venvs/ansible-core/bin/python", "ansible_run_tags": ["all"], "ansible_skip_tags": [], "ansible_verbosity": 2, "ansible_version": {"full": "2.18.7", "major": 2, "minor": 18, "revision": 7, "string": "2.18.7"}, "expected_status": 200, "group_names": ["test_websites"], "groups": {"all": ["proxy1", "proxy2", "proxy3", "google", "github", "baidu", "httpbin"], "proxy_servers": ["proxy1", "proxy2", "proxy3"], "test_websites": ["google", "github", "baidu", "httpbin"], "ungrouped": []}, "inventory_dir": "/home/runner/work/monitor-webhtml/monitor-webhtml/inventory", "inventory_file": "/home/runner/work/monitor-webhtml/monitor-webhtml/inventory/hosts.yml", "inventory_hostname": "baidu", "inventory_hostname_short": "baidu", "playbook_dir": "/home/runner/work/monitor-webhtml/monitor-webhtml/playbooks", "request_timeout": 10, "test_url": "https://www.baidu.com"}}
2025-08-13 16:43:28,064 p=3491 u=runner n=ansible INFO| skipping: [localhost] => (item=httpbin)  => {"ansible_loop_var": "website_item", "msg": "This action (uri) does not support check mode.", "website_item": {"ansible_check_mode": true, "ansible_config_file": "/home/runner/work/monitor-webhtml/monitor-webhtml/ansible.cfg", "ansible_diff_mode": false, "ansible_facts": {}, "ansible_forks": 5, "ansible_inventory_sources": ["/home/runner/work/monitor-webhtml/monitor-webhtml/inventory/hosts.yml"], "ansible_playbook_python": "/opt/pipx/venvs/ansible-core/bin/python", "ansible_run_tags": ["all"], "ansible_skip_tags": [], "ansible_verbosity": 2, "ansible_version": {"full": "2.18.7", "major": 2, "minor": 18, "revision": 7, "string": "2.18.7"}, "expected_status": 200, "group_names": ["test_websites"], "groups": {"all": ["proxy1", "proxy2", "proxy3", "google", "github", "baidu", "httpbin"], "proxy_servers": ["proxy1", "proxy2", "proxy3"], "test_websites": ["google", "github", "baidu", "httpbin"], "ungrouped": []}, "inventory_dir": "/home/runner/work/monitor-webhtml/monitor-webhtml/inventory", "inventory_file": "/home/runner/work/monitor-webhtml/monitor-webhtml/inventory/hosts.yml", "inventory_hostname": "httpbin", "inventory_hostname_short": "httpbin", "playbook_dir": "/home/runner/work/monitor-webhtml/monitor-webhtml/playbooks", "request_timeout": 5, "test_url": "https://httpbin.org/status/200"}}
2025-08-13 16:43:28,065 p=3491 u=runner n=ansible INFO| skipping: [localhost] => {"changed": false, "msg": "All items skipped"}
2025-08-13 16:43:28,070 p=3491 u=runner n=ansible INFO| TASK [proxy-monitor : 处理每个网站的测试结果] **************************************************************************
2025-08-13 16:43:28,070 p=3491 u=runner n=ansible INFO| task path: /home/runner/work/monitor-webhtml/monitor-webhtml/roles/proxy-monitor/tasks/test_proxy.yml:30
2025-08-13 16:43:28,130 p=3491 u=runner n=ansible INFO| ok: [localhost] => (item=0) => {"ansible_facts": {"failed_count": "1", "proxy_tests": [{"error_msg": "This action (uri) does not support check mode.", "response_time": "-1", "status": "FAILED", "status_code": "-1", "timestamp": "2025-08-13T16:43:27Z", "url": "https://www.google.com", "website": "google"}], "successful_count": "0"}, "ansible_loop_var": "item_index", "changed": false, "item_index": 0}
2025-08-13 16:43:28,171 p=3491 u=runner n=ansible INFO| ok: [localhost] => (item=1) => {"ansible_facts": {"failed_count": "2", "proxy_tests": [{"error_msg": "This action (uri) does not support check mode.", "response_time": "-1", "status": "FAILED", "status_code": "-1", "timestamp": "2025-08-13T16:43:27Z", "url": "https://www.google.com", "website": "google"}, {"error_msg": "This action (uri) does not support check mode.", "response_time": "-1", "status": "FAILED", "status_code": "-1", "timestamp": "2025-08-13T16:43:27Z", "url": "https://github.com", "website": "github"}], "successful_count": "0"}, "ansible_loop_var": "item_index", "changed": false, "item_index": 1}
2025-08-13 16:43:28,213 p=3491 u=runner n=ansible INFO| ok: [localhost] => (item=2) => {"ansible_facts": {"failed_count": "3", "proxy_tests": [{"error_msg": "This action (uri) does not support check mode.", "response_time": "-1", "status": "FAILED", "status_code": "-1", "timestamp": "2025-08-13T16:43:27Z", "url": "https://www.google.com", "website": "google"}, {"error_msg": "This action (uri) does not support check mode.", "response_time": "-1", "status": "FAILED", "status_code": "-1", "timestamp": "2025-08-13T16:43:27Z", "url": "https://github.com", "website": "github"}, {"error_msg": "This action (uri) does not support check mode.", "response_time": "-1", "status": "FAILED", "status_code": "-1", "timestamp": "2025-08-13T16:43:27Z", "url": "https://www.baidu.com", "website": "baidu"}], "successful_count": "0"}, "ansible_loop_var": "item_index", "changed": false, "item_index": 2}
2025-08-13 16:43:28,258 p=3491 u=runner n=ansible INFO| ok: [localhost] => (item=3) => {"ansible_facts": {"failed_count": "4", "proxy_tests": [{"error_msg": "This action (uri) does not support check mode.", "response_time": "-1", "status": "FAILED", "status_code": "-1", "timestamp": "2025-08-13T16:43:27Z", "url": "https://www.google.com", "website": "google"}, {"error_msg": "This action (uri) does not support check mode.", "response_time": "-1", "status": "FAILED", "status_code": "-1", "timestamp": "2025-08-13T16:43:27Z", "url": "https://github.com", "website": "github"}, {"error_msg": "This action (uri) does not support check mode.", "response_time": "-1", "status": "FAILED", "status_code": "-1", "timestamp": "2025-08-13T16:43:27Z", "url": "https://www.baidu.com", "website": "baidu"}, {"error_msg": "This action (uri) does not support check mode.", "response_time": "-1", "status": "FAILED", "status_code": "-1", "timestamp": "2025-08-13T16:43:27Z", "url": "https://httpbin.org/status/200", "website": "httpbin"}], "successful_count": "0"}, "ansible_loop_var": "item_index", "changed": false, "item_index": 3}
2025-08-13 16:43:28,265 p=3491 u=runner n=ansible INFO| TASK [proxy-monitor : 处理检查模式的测试结果] **************************************************************************
2025-08-13 16:43:28,265 p=3491 u=runner n=ansible INFO| task path: /home/runner/work/monitor-webhtml/monitor-webhtml/roles/proxy-monitor/tasks/test_proxy.yml:50
2025-08-13 16:43:28,286 p=3491 u=runner n=ansible INFO| skipping: [localhost] => (item=0)  => {"ansible_loop_var": "item_index", "changed": false, "false_condition": "ansible_check_mode and website_test_result.results is not defined", "item_index": 0, "skip_reason": "Conditional result was False"}
2025-08-13 16:43:28,288 p=3491 u=runner n=ansible INFO| skipping: [localhost] => (item=1)  => {"ansible_loop_var": "item_index", "changed": false, "false_condition": "ansible_check_mode and website_test_result.results is not defined", "item_index": 1, "skip_reason": "Conditional result was False"}
2025-08-13 16:43:28,290 p=3491 u=runner n=ansible INFO| skipping: [localhost] => (item=2)  => {"ansible_loop_var": "item_index", "changed": false, "false_condition": "ansible_check_mode and website_test_result.results is not defined", "item_index": 2, "skip_reason": "Conditional result was False"}
2025-08-13 16:43:28,293 p=3491 u=runner n=ansible INFO| skipping: [localhost] => (item=3)  => {"ansible_loop_var": "item_index", "changed": false, "false_condition": "ansible_check_mode and website_test_result.results is not defined", "item_index": 3, "skip_reason": "Conditional result was False"}
2025-08-13 16:43:28,293 p=3491 u=runner n=ansible INFO| skipping: [localhost] => {"changed": false, "msg": "All items skipped"}
2025-08-13 16:43:28,299 p=3491 u=runner n=ansible INFO| TASK [proxy-monitor : 存储代理测试结果] ********************************************************************************
2025-08-13 16:43:28,299 p=3491 u=runner n=ansible INFO| task path: /home/runner/work/monitor-webhtml/monitor-webhtml/roles/proxy-monitor/tasks/test_proxy.yml:68
2025-08-13 16:43:28,327 p=3491 u=runner n=ansible INFO| ok: [localhost] => {"ansible_facts": {"proxy_status": "UNHEALTHY", "proxy_success_rate": "0.0", "proxy_test_results": {"proxy1": {"failed_tests": "4", "proxy_name": "proxy1", "proxy_url": "http://192.168.10.3:10810", "status": "UNHEALTHY", "success_rate": 0.0, "successful_tests": "0", "test_details": [{"error_msg": "This action (uri) does not support check mode.", "response_time": "-1", "status": "FAILED", "status_code": "-1", "timestamp": "2025-08-13T16:43:27Z", "url": "https://www.google.com", "website": "google"}, {"error_msg": "This action (uri) does not support check mode.", "response_time": "-1", "status": "FAILED", "status_code": "-1", "timestamp": "2025-08-13T16:43:27Z", "url": "https://github.com", "website": "github"}, {"error_msg": "This action (uri) does not support check mode.", "response_time": "-1", "status": "FAILED", "status_code": "-1", "timestamp": "2025-08-13T16:43:27Z", "url": "https://www.baidu.com", "website": "baidu"}, {"error_msg": "This action (uri) does not support check mode.", "response_time": "-1", "status": "FAILED", "status_code": "-1", "timestamp": "2025-08-13T16:43:27Z", "url": "https://httpbin.org/status/200", "website": "httpbin"}], "timestamp": "2025-08-13T16:43:27Z", "total_tests": 4}}}, "changed": false}
2025-08-13 16:43:28,333 p=3491 u=runner n=ansible INFO| TASK [proxy-monitor : 生成监控日志] ************************************************************************************
2025-08-13 16:43:28,333 p=3491 u=runner n=ansible INFO| task path: /home/runner/work/monitor-webhtml/monitor-webhtml/roles/proxy-monitor/tasks/main.yml:24
2025-08-13 16:43:28,653 p=3491 u=runner n=ansible INFO| changed: [localhost] => {"changed": true}
2025-08-13 16:43:28,664 p=3491 u=runner n=ansible INFO| TASK [发送告警邮件] ****************************************************************************************************
2025-08-13 16:43:28,664 p=3491 u=runner n=ansible INFO| task path: /home/runner/work/monitor-webhtml/monitor-webhtml/playbooks/monitor-proxies.yml:26
2025-08-13 16:43:28,699 p=3491 u=runner n=ansible INFO| redirecting (type: modules) ansible.builtin.mail to community.general.mail
2025-08-13 16:43:28,866 p=3491 u=runner n=ansible INFO| included: proxy-monitor for localhost
2025-08-13 16:43:28,872 p=3491 u=runner n=ansible INFO| TASK [proxy-monitor : 生成HTML告警邮件] ********************************************************************************
2025-08-13 16:43:28,872 p=3491 u=runner n=ansible INFO| task path: /home/runner/work/monitor-webhtml/monitor-webhtml/roles/proxy-monitor/tasks/send_alerts.yml:4
2025-08-13 16:43:29,068 p=3491 u=runner n=ansible INFO| changed: [localhost] => {"changed": true}
2025-08-13 16:43:29,074 p=3491 u=runner n=ansible INFO| TASK [proxy-monitor : 发送告警邮件] ************************************************************************************
2025-08-13 16:43:29,074 p=3491 u=runner n=ansible INFO| task path: /home/runner/work/monitor-webhtml/monitor-webhtml/roles/proxy-monitor/tasks/send_alerts.yml:13
2025-08-13 16:43:29,111 p=3491 u=runner n=ansible INFO| fatal: [localhost]: FAILED! => {"msg": "The 'file' lookup had an issue accessing the file '/home/runner/work/monitor-webhtml/monitor-webhtml/logs/alert_email.html'. file not found, use -vvvvv to see paths searched"}
2025-08-13 16:43:29,111 p=3491 u=runner n=ansible INFO| ...ignoring
2025-08-13 16:43:29,118 p=3491 u=runner n=ansible INFO| TASK [proxy-monitor : 记录邮件发送结果] ********************************************************************************
2025-08-13 16:43:29,118 p=3491 u=runner n=ansible INFO| task path: /home/runner/work/monitor-webhtml/monitor-webhtml/roles/proxy-monitor/tasks/send_alerts.yml:28
2025-08-13 16:43:29,135 p=3491 u=runner n=ansible INFO| ok: [localhost] => {
    "msg": "告警邮件发送失败: The 'file' lookup had an issue accessing the file '/home/runner/work/monitor-webhtml/monitor-webhtml/logs/alert_email.html'. file not found, use -vvvvv to see paths searched"
}
2025-08-13 16:43:29,145 p=3491 u=runner n=ansible INFO| TASK [监控状态总结] ****************************************************************************************************
2025-08-13 16:43:29,145 p=3491 u=runner n=ansible INFO| task path: /home/runner/work/monitor-webhtml/monitor-webhtml/playbooks/monitor-proxies.yml:35
2025-08-13 16:43:29,156 p=3491 u=runner n=ansible INFO| ok: [localhost] => {
    "msg": "代理监控周期已完成。详细日志请查看: /home/runner/work/monitor-webhtml/monitor-webhtml/logs/proxy_monitor.log"
}
2025-08-13 16:43:29,157 p=3491 u=runner n=ansible INFO| PLAY RECAP *************************************************************************************************************
2025-08-13 16:43:29,157 p=3491 u=runner n=ansible INFO| localhost                  : ok=17   changed=2    unreachable=0    failed=0    skipped=2    rescued=0    ignored=1   
2025-08-13 16:44:17,273 p=3694 u=runner n=ansible INFO| PLAY [测试状态判断逻辑] ************************************************************************************************
2025-08-13 16:44:17,278 p=3694 u=runner n=ansible INFO| TASK [模拟HTTP 200响应的状态判断] **************************************************************************************
2025-08-13 16:44:17,287 p=3694 u=runner n=ansible INFO| ok: [localhost]
2025-08-13 16:44:17,288 p=3694 u=runner n=ansible INFO| TASK [测试各种HTTP状态码的判断逻辑] ************************************************************************************
2025-08-13 16:44:17,317 p=3694 u=runner n=ansible INFO| ok: [localhost] => (item={'website': 'google', 'url': 'https://www.google.com', 'status_code': 200, 'response_time': 401.6})
2025-08-13 16:44:17,333 p=3694 u=runner n=ansible INFO| ok: [localhost] => (item={'website': 'github', 'url': 'https://github.com', 'status_code': 200, 'response_time': 345.58})
2025-08-13 16:44:17,349 p=3694 u=runner n=ansible INFO| ok: [localhost] => (item={'website': 'baidu', 'url': 'https://www.baidu.com', 'status_code': 200, 'response_time': 123.09})
2025-08-13 16:44:17,366 p=3694 u=runner n=ansible INFO| ok: [localhost] => (item={'website': 'httpbin', 'url': 'https://httpbin.org/status/200', 'status_code': 200, 'response_time': 1165.06})
2025-08-13 16:44:17,384 p=3694 u=runner n=ansible INFO| ok: [localhost] => (item={'website': 'bad_site', 'url': 'https://bad.example.com', 'status_code': 404, 'response_time': 1000})
2025-08-13 16:44:17,386 p=3694 u=runner n=ansible INFO| TASK [计算代理状态] ****************************************************************************************************
2025-08-13 16:44:17,405 p=3694 u=runner n=ansible INFO| ok: [localhost]
2025-08-13 16:44:17,407 p=3694 u=runner n=ansible INFO| TASK [显示测试结果] ****************************************************************************************************
2025-08-13 16:44:17,425 p=3694 u=runner n=ansible INFO| ok: [localhost] => {
    "msg": [
        "成功测试: 4",
        "失败测试: 1",
        "总测试: 5",
        "成功率: 80.0%",
        "代理状态: HEALTHY",
        "测试详情:",
        "  • google (https://www.google.com): SUCCESS - HTTP 200 - 401.6ms  • github (https://github.com): SUCCESS - HTTP 200 - 345.58ms  • baidu (https://www.baidu.com): SUCCESS - HTTP 200 - 123.09ms  • httpbin (https://httpbin.org/status/200): SUCCESS - HTTP 200 - 1165.06ms  • bad_site (https://bad.example.com): FAILED - HTTP 404 - 1000ms"
    ]
}
2025-08-13 16:44:17,426 p=3694 u=runner n=ansible INFO| PLAY RECAP *************************************************************************************************************
2025-08-13 16:44:17,426 p=3694 u=runner n=ansible INFO| localhost                  : ok=4    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2025-08-13 16:45:18,930 p=3731 u=runner n=ansible INFO| Using /home/runner/work/monitor-webhtml/monitor-webhtml/ansible.cfg as config file
2025-08-13 16:45:19,081 p=3731 u=runner n=ansible INFO| PLAY [测试无代理直接连接] **********************************************************************************************
2025-08-13 16:45:19,086 p=3731 u=runner n=ansible INFO| TASK [Gathering Facts] *************************************************************************************************
2025-08-13 16:45:19,959 p=3731 u=runner n=ansible INFO| ok: [localhost]
2025-08-13 16:45:19,963 p=3731 u=runner n=ansible INFO| TASK [初始化测试结果] **************************************************************************************************
2025-08-13 16:45:19,973 p=3731 u=runner n=ansible INFO| ok: [localhost] => {"ansible_facts": {"current_timestamp": "2025-08-13T16:45:19Z", "failed_count": 0, "proxy_name": "test_direct", "proxy_tests": [], "successful_count": 0}, "changed": false}
2025-08-13 16:45:19,978 p=3731 u=runner n=ansible INFO| TASK [测试网站连通性（无代理）] ****************************************************************************************
2025-08-13 16:45:20,543 p=3731 u=runner n=ansible INFO| ok: [localhost] => (item=httpbin) => {"ansible_loop_var": "website_item", "changed": false, "failed_when_result": false, "msg": "Unsupported parameters for (ansible.legacy.uri) module: user_agent. Supported parameters include: attributes, body, body_format, ca_path, ciphers, client_cert, client_key, creates, decompress, dest, follow_redirects, force, force_basic_auth, group, headers, http_agent, method, mode, owner, remote_src, removes, return_content, selevel, serole, setype, seuser, src, status_code, timeout, unix_socket, unredirected_headers, unsafe_writes, url, url_password, url_username, use_gssapi, use_netrc, use_proxy, validate_certs (attr, password, user).", "website_item": {"inventory_hostname": "httpbin", "request_timeout": 10, "test_url": "https://httpbin.org/status/200"}}
2025-08-13 16:45:20,778 p=3731 u=runner n=ansible INFO| ok: [localhost] => (item=github) => {"ansible_loop_var": "website_item", "changed": false, "failed_when_result": false, "msg": "Unsupported parameters for (ansible.legacy.uri) module: user_agent. Supported parameters include: attributes, body, body_format, ca_path, ciphers, client_cert, client_key, creates, decompress, dest, follow_redirects, force, force_basic_auth, group, headers, http_agent, method, mode, owner, remote_src, removes, return_content, selevel, serole, setype, seuser, src, status_code, timeout, unix_socket, unredirected_headers, unsafe_writes, url, url_password, url_username, use_gssapi, use_netrc, use_proxy, validate_certs (attr, password, user).", "website_item": {"inventory_hostname": "github", "request_timeout": 15, "test_url": "https://github.com"}}
2025-08-13 16:45:20,784 p=3731 u=runner n=ansible INFO| TASK [处理测试结果] ****************************************************************************************************
2025-08-13 16:45:20,839 p=3731 u=runner n=ansible INFO| ok: [localhost] => (item=0) => {"ansible_facts": {"failed_count": "1", "proxy_tests": [{"error_msg": "Unsupported parameters for (ansible.legacy.uri) module: user_agent. Supported parameters include: attributes, body, body_format, ca_path, ciphers, client_cert, client_key, creates, decompress, dest, follow_redirects, force, force_basic_auth, group, headers, http_agent, method, mode, owner, remote_src, removes, return_content, selevel, serole, setype, seuser, src, status_code, timeout, unix_socket, unredirected_headers, unsafe_writes, url, url_password, url_username, use_gssapi, use_netrc, use_proxy, validate_certs (attr, password, user).", "response_time": "-1", "status": "FAILED", "status_code": "-1", "timestamp": "2025-08-13T16:45:19Z", "url": "https://httpbin.org/status/200", "website": "httpbin"}], "successful_count": "0"}, "ansible_loop_var": "item_index", "changed": false, "item_index": 0}
2025-08-13 16:45:20,875 p=3731 u=runner n=ansible INFO| ok: [localhost] => (item=1) => {"ansible_facts": {"failed_count": "2", "proxy_tests": [{"error_msg": "Unsupported parameters for (ansible.legacy.uri) module: user_agent. Supported parameters include: attributes, body, body_format, ca_path, ciphers, client_cert, client_key, creates, decompress, dest, follow_redirects, force, force_basic_auth, group, headers, http_agent, method, mode, owner, remote_src, removes, return_content, selevel, serole, setype, seuser, src, status_code, timeout, unix_socket, unredirected_headers, unsafe_writes, url, url_password, url_username, use_gssapi, use_netrc, use_proxy, validate_certs (attr, password, user).", "response_time": "-1", "status": "FAILED", "status_code": "-1", "timestamp": "2025-08-13T16:45:19Z", "url": "https://httpbin.org/status/200", "website": "httpbin"}, {"error_msg": "Unsupported parameters for (ansible.legacy.uri) module: user_agent. Supported parameters include: attributes, body, body_format, ca_path, ciphers, client_cert, client_key, creates, decompress, dest, follow_redirects, force, force_basic_auth, group, headers, http_agent, method, mode, owner, remote_src, removes, return_content, selevel, serole, setype, seuser, src, status_code, timeout, unix_socket, unredirected_headers, unsafe_writes, url, url_password, url_username, use_gssapi, use_netrc, use_proxy, validate_certs (attr, password, user).", "response_time": "-1", "status": "FAILED", "status_code": "-1", "timestamp": "2025-08-13T16:45:19Z", "url": "https://github.com", "website": "github"}], "successful_count": "0"}, "ansible_loop_var": "item_index", "changed": false, "item_index": 1}
2025-08-13 16:45:20,881 p=3731 u=runner n=ansible INFO| TASK [计算结果] ********************************************************************************************************
2025-08-13 16:45:20,900 p=3731 u=runner n=ansible INFO| ok: [localhost] => {"ansible_facts": {"proxy_status": "UNHEALTHY", "proxy_success_rate": "0.0"}, "changed": false}
2025-08-13 16:45:20,904 p=3731 u=runner n=ansible INFO| TASK [显示测试结果] ****************************************************************************************************
2025-08-13 16:45:20,925 p=3731 u=runner n=ansible INFO| ok: [localhost] => {
    "msg": [
        "代理地址: 直接连接（无代理）",
        "状态: UNHEALTHY",
        "成功率: 0.0%",
        "测试结果: 0/2 成功",
        "检测时间: 2025-08-13T16:45:19Z",
        "",
        "网站测试结果:",
        "  • httpbin (https://httpbin.org/status/200)  • github (https://github.com)",
        "    状态: FAILED    状态: FAILED",
        "    响应时间: -1ms    响应时间: -1ms",
        "    HTTP状态码: -1    HTTP状态码: -1"
    ]
}
2025-08-13 16:45:20,926 p=3731 u=runner n=ansible INFO| PLAY RECAP *************************************************************************************************************
2025-08-13 16:45:20,926 p=3731 u=runner n=ansible INFO| localhost                  : ok=6    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2025-08-13 16:46:25,457 p=3901 u=runner n=ansible INFO| PLAY [测试无代理直接连接] **********************************************************************************************
2025-08-13 16:46:25,463 p=3901 u=runner n=ansible INFO| TASK [Gathering Facts] *************************************************************************************************
2025-08-13 16:46:26,350 p=3901 u=runner n=ansible INFO| ok: [localhost]
2025-08-13 16:46:26,354 p=3901 u=runner n=ansible INFO| TASK [初始化测试结果] **************************************************************************************************
2025-08-13 16:46:26,364 p=3901 u=runner n=ansible INFO| ok: [localhost]
2025-08-13 16:46:26,368 p=3901 u=runner n=ansible INFO| TASK [测试网站连通性（无代理）] ****************************************************************************************
2025-08-13 16:46:26,746 p=3901 u=runner n=ansible INFO| ok: [localhost] => (item=httpbin)
2025-08-13 16:46:27,005 p=3901 u=runner n=ansible INFO| ok: [localhost] => (item=httpbin404)
2025-08-13 16:46:27,007 p=3901 u=runner n=ansible INFO| [DEPRECATION WARNING]: Using 'yes' or 'no' for 'follow_redirects' parameter is deprecated. This feature will be removed
 in version 2.22. Deprecation warnings can be disabled by setting deprecation_warnings=False in ansible.cfg.
2025-08-13 16:46:27,012 p=3901 u=runner n=ansible INFO| TASK [处理测试结果] ****************************************************************************************************
2025-08-13 16:46:27,067 p=3901 u=runner n=ansible INFO| ok: [localhost] => (item=0)
2025-08-13 16:46:27,104 p=3901 u=runner n=ansible INFO| ok: [localhost] => (item=1)
2025-08-13 16:46:27,110 p=3901 u=runner n=ansible INFO| TASK [计算结果] ********************************************************************************************************
2025-08-13 16:46:27,128 p=3901 u=runner n=ansible INFO| ok: [localhost]
2025-08-13 16:46:27,133 p=3901 u=runner n=ansible INFO| TASK [显示详细结果] ****************************************************************************************************
2025-08-13 16:46:27,148 p=3901 u=runner n=ansible INFO| ok: [localhost] => {
    "msg": [
        "代理地址: 直接连接（无代理）",
        "状态: UNHEALTHY",
        "成功率: 0.0%",
        "测试结果: 0/2 成功",
        "检测时间: 2025-08-13T16:46:25Z",
        "",
        "网站测试结果:"
    ]
}
2025-08-13 16:46:27,152 p=3901 u=runner n=ansible INFO| TASK [显示每个网站的详细结果] ******************************************************************************************
2025-08-13 16:46:27,167 p=3901 u=runner n=ansible INFO| ok: [localhost] => (item={'website': 'httpbin', 'url': 'https://httpbin.org/status/200', 'status': 'FAILED', 'status_code': '-1', 'response_time': '0', 'error_msg': 'Status code was -1 and not [200]: Request failed: <urlopen error [Errno -5] No address associated with hostname>', 'timestamp': '2025-08-13T16:46:25Z'}) => {
    "msg": [
        "  • httpbin (https://httpbin.org/status/200)",
        "    状态: FAILED",
        "    响应时间: 0ms",
        "    HTTP状态码: -1",
        "    错误信息: Status code was -1 and not [200]: Request failed: <urlopen error [Errno -5] No address associated with hostname>"
    ]
}
2025-08-13 16:46:27,172 p=3901 u=runner n=ansible INFO| ok: [localhost] => (item={'website': 'httpbin404', 'url': 'https://httpbin.org/status/404', 'status': 'FAILED', 'status_code': '-1', 'response_time': '0', 'error_msg': 'Status code was -1 and not [200]: Request failed: <urlopen error [Errno -5] No address associated with hostname>', 'timestamp': '2025-08-13T16:46:25Z'}) => {
    "msg": [
        "  • httpbin404 (https://httpbin.org/status/404)",
        "    状态: FAILED",
        "    响应时间: 0ms",
        "    HTTP状态码: -1",
        "    错误信息: Status code was -1 and not [200]: Request failed: <urlopen error [Errno -5] No address associated with hostname>"
    ]
}
2025-08-13 16:46:27,173 p=3901 u=runner n=ansible INFO| PLAY RECAP *************************************************************************************************************
2025-08-13 16:46:27,173 p=3901 u=runner n=ansible INFO| localhost                  : ok=7    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2025-08-13 16:46:40,266 p=4061 u=runner n=ansible INFO| playbook: playbooks/monitor-proxies.yml
2025-08-13 16:47:15,405 p=4074 u=runner n=ansible INFO| PLAY [测试预期成功场景] ************************************************************************************************
2025-08-13 16:47:15,410 p=4074 u=runner n=ansible INFO| TASK [Gathering Facts] *************************************************************************************************
2025-08-13 16:47:16,296 p=4074 u=runner n=ansible INFO| ok: [localhost]
2025-08-13 16:47:16,300 p=4074 u=runner n=ansible INFO| TASK [初始化代理测试结果] **********************************************************************************************
2025-08-13 16:47:16,308 p=4074 u=runner n=ansible INFO| ok: [localhost]
2025-08-13 16:47:16,312 p=4074 u=runner n=ansible INFO| TASK [处理模拟的测试结果] **********************************************************************************************
2025-08-13 16:47:16,341 p=4074 u=runner n=ansible INFO| ok: [localhost] => (item={'website': 'google', 'url': 'https://www.google.com', 'status_code': 200, 'response_time': 401.6, 'error_msg': ''})
2025-08-13 16:47:16,357 p=4074 u=runner n=ansible INFO| ok: [localhost] => (item={'website': 'github', 'url': 'https://github.com', 'status_code': 200, 'response_time': 345.58, 'error_msg': ''})
2025-08-13 16:47:16,373 p=4074 u=runner n=ansible INFO| ok: [localhost] => (item={'website': 'baidu', 'url': 'https://www.baidu.com', 'status_code': 200, 'response_time': 123.09, 'error_msg': ''})
2025-08-13 16:47:16,390 p=4074 u=runner n=ansible INFO| ok: [localhost] => (item={'website': 'httpbin', 'url': 'https://httpbin.org/status/200', 'status_code': 200, 'response_time': 1165.06, 'error_msg': ''})
2025-08-13 16:47:16,395 p=4074 u=runner n=ansible INFO| TASK [存储代理测试结果] ************************************************************************************************
2025-08-13 16:47:16,419 p=4074 u=runner n=ansible INFO| ok: [localhost]
2025-08-13 16:47:16,425 p=4074 u=runner n=ansible INFO| TASK [生成监控日志] ****************************************************************************************************
2025-08-13 16:47:16,612 p=4074 u=runner n=ansible INFO| An exception occurred during task execution. To see the full traceback, use -vvv. The error was: If you are using a module and expect the file to exist on the remote, see the remote_src option
2025-08-13 16:47:16,613 p=4074 u=runner n=ansible INFO| fatal: [localhost]: FAILED! => {"changed": false, "msg": "Could not find or access '/tmp/../roles/proxy-monitor/templates/log-format.j2' on the Ansible Controller.\nIf you are using a module and expect the file to exist on the remote, see the remote_src option"}
2025-08-13 16:47:16,613 p=4074 u=runner n=ansible INFO| PLAY RECAP *************************************************************************************************************
2025-08-13 16:47:16,613 p=4074 u=runner n=ansible INFO| localhost                  : ok=4    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2025-08-13 16:47:38,227 p=4202 u=runner n=ansible INFO| PLAY [测试预期成功场景] ************************************************************************************************
2025-08-13 16:47:38,232 p=4202 u=runner n=ansible INFO| TASK [Gathering Facts] *************************************************************************************************
2025-08-13 16:47:39,128 p=4202 u=runner n=ansible INFO| ok: [localhost]
2025-08-13 16:47:39,132 p=4202 u=runner n=ansible INFO| TASK [初始化代理测试结果] **********************************************************************************************
2025-08-13 16:47:39,140 p=4202 u=runner n=ansible INFO| ok: [localhost]
2025-08-13 16:47:39,144 p=4202 u=runner n=ansible INFO| TASK [处理模拟的测试结果] **********************************************************************************************
2025-08-13 16:47:39,173 p=4202 u=runner n=ansible INFO| ok: [localhost] => (item={'website': 'google', 'url': 'https://www.google.com', 'status_code': 200, 'response_time': 401.6, 'error_msg': ''})
2025-08-13 16:47:39,189 p=4202 u=runner n=ansible INFO| ok: [localhost] => (item={'website': 'github', 'url': 'https://github.com', 'status_code': 200, 'response_time': 345.58, 'error_msg': ''})
2025-08-13 16:47:39,205 p=4202 u=runner n=ansible INFO| ok: [localhost] => (item={'website': 'baidu', 'url': 'https://www.baidu.com', 'status_code': 200, 'response_time': 123.09, 'error_msg': ''})
2025-08-13 16:47:39,221 p=4202 u=runner n=ansible INFO| ok: [localhost] => (item={'website': 'httpbin', 'url': 'https://httpbin.org/status/200', 'status_code': 200, 'response_time': 1165.06, 'error_msg': ''})
2025-08-13 16:47:39,226 p=4202 u=runner n=ansible INFO| TASK [存储代理测试结果] ************************************************************************************************
2025-08-13 16:47:39,251 p=4202 u=runner n=ansible INFO| ok: [localhost]
2025-08-13 16:47:39,255 p=4202 u=runner n=ansible INFO| TASK [生成监控日志] ****************************************************************************************************
2025-08-13 16:47:39,394 p=4202 u=runner n=ansible INFO| An exception occurred during task execution. To see the full traceback, use -vvv. The error was: ansible.errors.AnsibleUndefinedVariable: 'dict object' has no attribute 'log_format'
2025-08-13 16:47:39,394 p=4202 u=runner n=ansible INFO| fatal: [localhost]: FAILED! => {"changed": false, "msg": "AnsibleUndefinedVariable: 'dict object' has no attribute 'log_format'"}
2025-08-13 16:47:39,395 p=4202 u=runner n=ansible INFO| PLAY RECAP *************************************************************************************************************
2025-08-13 16:47:39,395 p=4202 u=runner n=ansible INFO| localhost                  : ok=4    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2025-08-13 16:48:15,425 p=4332 u=runner n=ansible INFO| PLAY [显示预期成功场景输出] ********************************************************************************************
2025-08-13 16:48:15,430 p=4332 u=runner n=ansible INFO| TASK [显示预期的成功输出格式] ******************************************************************************************
2025-08-13 16:48:15,467 p=4332 u=runner n=ansible INFO| fatal: [localhost]: FAILED! => {"msg": "template error while templating string: Unexpected end of template. Jinja was looking for the following tags: 'endfor' or 'else'. The innermost block that needs to be closed is 'for'.. String: {% for test in proxy_test_results.proxy1.test_details %}  • {{ test.website }} ({{ test.url }}). Unexpected end of template. Jinja was looking for the following tags: 'endfor' or 'else'. The innermost block that needs to be closed is 'for'."}
2025-08-13 16:48:15,467 p=4332 u=runner n=ansible INFO| PLAY RECAP *************************************************************************************************************
2025-08-13 16:48:15,467 p=4332 u=runner n=ansible INFO| localhost                  : ok=0    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   
2025-08-13 16:48:46,092 p=4342 u=runner n=ansible INFO| PLAY [显示预期成功场景输出] ********************************************************************************************
2025-08-13 16:48:46,097 p=4342 u=runner n=ansible INFO| TASK [显示预期的成功输出格式] ******************************************************************************************
2025-08-13 16:48:46,129 p=4342 u=runner n=ansible INFO| ok: [localhost] => {
    "msg": [
        "===============================================================================",
        "代理监控报告",
        "===============================================================================",
        "时间: 2025-08-13T16:35:48Z",
        "系统: Ansible 代理监控系统",
        "",
        "汇总信息:",
        "--------",
        "监控代理总数: 1",
        "健康代理数量: 1",
        "异常代理数量: 0",
        "总体成功率: 100.0%",
        "",
        "详细结果:",
        "---------",
        "",
        "[HEALTHY] proxy1",
        "代理地址: http://192.168.10.3:10810",
        "状态: HEALTHY",
        "成功率: 100.0%",
        "测试结果: 4/4 成功",
        "检测时间: 2025-08-13T16:35:48Z",
        "",
        "网站测试结果:"
    ]
}
2025-08-13 16:48:46,130 p=4342 u=runner n=ansible INFO| TASK [显示网站测试详情] ************************************************************************************************
2025-08-13 16:48:46,145 p=4342 u=runner n=ansible INFO| ok: [localhost] => (item={'website': 'google', 'url': 'https://www.google.com', 'status': 'SUCCESS', 'status_code': 200, 'response_time': 401.6, 'error_msg': '', 'timestamp': '2025-08-13T16:35:48Z'}) => {
    "msg": [
        "  • google (https://www.google.com)",
        "    状态: SUCCESS",
        "    响应时间: 401.6ms",
        "    HTTP状态码: 200"
    ]
}
2025-08-13 16:48:46,149 p=4342 u=runner n=ansible INFO| ok: [localhost] => (item={'website': 'github', 'url': 'https://github.com', 'status': 'SUCCESS', 'status_code': 200, 'response_time': 345.58, 'error_msg': '', 'timestamp': '2025-08-13T16:35:48Z'}) => {
    "msg": [
        "  • github (https://github.com)",
        "    状态: SUCCESS",
        "    响应时间: 345.58ms",
        "    HTTP状态码: 200"
    ]
}
2025-08-13 16:48:46,154 p=4342 u=runner n=ansible INFO| ok: [localhost] => (item={'website': 'baidu', 'url': 'https://www.baidu.com', 'status': 'SUCCESS', 'status_code': 200, 'response_time': 123.09, 'error_msg': '', 'timestamp': '2025-08-13T16:35:48Z'}) => {
    "msg": [
        "  • baidu (https://www.baidu.com)",
        "    状态: SUCCESS",
        "    响应时间: 123.09ms",
        "    HTTP状态码: 200"
    ]
}
2025-08-13 16:48:46,158 p=4342 u=runner n=ansible INFO| ok: [localhost] => (item={'website': 'httpbin', 'url': 'https://httpbin.org/status/200', 'status': 'SUCCESS', 'status_code': 200, 'response_time': 1165.06, 'error_msg': '', 'timestamp': '2025-08-13T16:35:48Z'}) => {
    "msg": [
        "  • httpbin (https://httpbin.org/status/200)",
        "    状态: SUCCESS",
        "    响应时间: 1165.06ms",
        "    HTTP状态码: 200"
    ]
}
2025-08-13 16:48:46,160 p=4342 u=runner n=ansible INFO| PLAY RECAP *************************************************************************************************************
2025-08-13 16:48:46,160 p=4342 u=runner n=ansible INFO| localhost                  : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
2025-08-13 16:49:34,016 p=4373 u=runner n=ansible INFO| playbook: playbooks/monitor-proxies.yml
2025-08-13 16:49:43,157 p=4377 u=runner n=ansible INFO| PLAY [代理状态和网站连通性监控] ****************************************************************************************
2025-08-13 16:49:43,162 p=4377 u=runner n=ansible INFO| TASK [Gathering Facts] *************************************************************************************************
2025-08-13 16:49:44,032 p=4377 u=runner n=ansible INFO| ok: [localhost]
2025-08-13 16:49:44,036 p=4377 u=runner n=ansible INFO| TASK [创建日志目录] ****************************************************************************************************
2025-08-13 16:49:44,299 p=4377 u=runner n=ansible INFO| ok: [localhost]
2025-08-13 16:49:44,305 p=4377 u=runner n=ansible INFO| TASK [初始化监控结果变量] **********************************************************************************************
2025-08-13 16:49:44,312 p=4377 u=runner n=ansible INFO| ok: [localhost]
2025-08-13 16:49:44,317 p=4377 u=runner n=ansible INFO| TASK [执行代理监控任务] ************************************************************************************************
2025-08-13 16:49:44,335 p=4377 u=runner n=ansible INFO| included: proxy-monitor for localhost
2025-08-13 16:49:44,340 p=4377 u=runner n=ansible INFO| TASK [proxy-monitor : 获取已启用的代理服务器列表] **********************************************************************
2025-08-13 16:49:44,361 p=4377 u=runner n=ansible INFO| ok: [localhost]
2025-08-13 16:49:44,367 p=4377 u=runner n=ansible INFO| TASK [proxy-monitor : 获取测试网站列表] ********************************************************************************
2025-08-13 16:49:44,386 p=4377 u=runner n=ansible INFO| ok: [localhost]
2025-08-13 16:49:44,392 p=4377 u=runner n=ansible INFO| TASK [proxy-monitor : 初始化测试结果] **********************************************************************************
2025-08-13 16:49:44,401 p=4377 u=runner n=ansible INFO| ok: [localhost]
2025-08-13 16:49:44,406 p=4377 u=runner n=ansible INFO| TASK [proxy-monitor : 对每个代理执行网站连通性测试] ********************************************************************
2025-08-13 16:49:44,426 p=4377 u=runner n=ansible INFO| included: /home/runner/work/monitor-webhtml/monitor-webhtml/roles/proxy-monitor/tasks/test_proxy.yml for localhost => (item=proxy1)
2025-08-13 16:49:44,431 p=4377 u=runner n=ansible INFO| TASK [proxy-monitor : 初始化代理测试结果] ******************************************************************************
2025-08-13 16:49:44,441 p=4377 u=runner n=ansible INFO| ok: [localhost]
2025-08-13 16:49:44,446 p=4377 u=runner n=ansible INFO| TASK [proxy-monitor : 测试代理对各网站的连通性] ************************************************************************
2025-08-13 16:49:44,469 p=4377 u=runner n=ansible INFO| skipping: [localhost] => (item=google) 
2025-08-13 16:49:44,476 p=4377 u=runner n=ansible INFO| skipping: [localhost] => (item=github) 
2025-08-13 16:49:44,483 p=4377 u=runner n=ansible INFO| skipping: [localhost] => (item=baidu) 
2025-08-13 16:49:44,490 p=4377 u=runner n=ansible INFO| skipping: [localhost] => (item=httpbin) 
2025-08-13 16:49:44,491 p=4377 u=runner n=ansible INFO| skipping: [localhost]
2025-08-13 16:49:44,496 p=4377 u=runner n=ansible INFO| TASK [proxy-monitor : 处理每个网站的测试结果] **************************************************************************
2025-08-13 16:49:44,557 p=4377 u=runner n=ansible INFO| ok: [localhost] => (item=0)
2025-08-13 16:49:44,597 p=4377 u=runner n=ansible INFO| ok: [localhost] => (item=1)
2025-08-13 16:49:44,639 p=4377 u=runner n=ansible INFO| ok: [localhost] => (item=2)
2025-08-13 16:49:44,684 p=4377 u=runner n=ansible INFO| ok: [localhost] => (item=3)
2025-08-13 16:49:44,692 p=4377 u=runner n=ansible INFO| TASK [proxy-monitor : 处理检查模式的测试结果] **************************************************************************
2025-08-13 16:49:44,712 p=4377 u=runner n=ansible INFO| skipping: [localhost] => (item=0) 
2025-08-13 16:49:44,715 p=4377 u=runner n=ansible INFO| skipping: [localhost] => (item=1) 
2025-08-13 16:49:44,717 p=4377 u=runner n=ansible INFO| skipping: [localhost] => (item=2) 
2025-08-13 16:49:44,719 p=4377 u=runner n=ansible INFO| skipping: [localhost] => (item=3) 
2025-08-13 16:49:44,720 p=4377 u=runner n=ansible INFO| skipping: [localhost]
2025-08-13 16:49:44,726 p=4377 u=runner n=ansible INFO| TASK [proxy-monitor : 存储代理测试结果] ********************************************************************************
2025-08-13 16:49:44,751 p=4377 u=runner n=ansible INFO| ok: [localhost]
2025-08-13 16:49:44,757 p=4377 u=runner n=ansible INFO| TASK [proxy-monitor : 生成监控日志] ************************************************************************************
2025-08-13 16:49:45,039 p=4377 u=runner n=ansible INFO| changed: [localhost]
2025-08-13 16:49:45,049 p=4377 u=runner n=ansible INFO| TASK [发送告警邮件] ****************************************************************************************************
2025-08-13 16:49:45,096 p=4377 u=runner n=ansible INFO| included: proxy-monitor for localhost
2025-08-13 16:49:45,102 p=4377 u=runner n=ansible INFO| TASK [proxy-monitor : 生成HTML告警邮件] ********************************************************************************
2025-08-13 16:49:45,291 p=4377 u=runner n=ansible INFO| changed: [localhost]
2025-08-13 16:49:45,297 p=4377 u=runner n=ansible INFO| TASK [proxy-monitor : 发送告警邮件] ************************************************************************************
2025-08-13 16:49:45,310 p=4377 u=runner n=ansible INFO| fatal: [localhost]: FAILED! => {"msg": "The 'file' lookup had an issue accessing the file '/home/runner/work/monitor-webhtml/monitor-webhtml/logs/alert_email.html'. file not found, use -vvvvv to see paths searched"}
2025-08-13 16:49:45,311 p=4377 u=runner n=ansible INFO| ...ignoring
2025-08-13 16:49:45,316 p=4377 u=runner n=ansible INFO| TASK [proxy-monitor : 记录邮件发送结果] ********************************************************************************
2025-08-13 16:49:45,333 p=4377 u=runner n=ansible INFO| ok: [localhost] => {
    "msg": "告警邮件发送失败: The 'file' lookup had an issue accessing the file '/home/runner/work/monitor-webhtml/monitor-webhtml/logs/alert_email.html'. file not found, use -vvvvv to see paths searched"
}
2025-08-13 16:49:45,343 p=4377 u=runner n=ansible INFO| TASK [监控状态总结] ****************************************************************************************************
2025-08-13 16:49:45,353 p=4377 u=runner n=ansible INFO| ok: [localhost] => {
    "msg": "代理监控周期已完成。详细日志请查看: /home/runner/work/monitor-webhtml/monitor-webhtml/logs/proxy_monitor.log"
}
2025-08-13 16:49:45,354 p=4377 u=runner n=ansible INFO| PLAY RECAP *************************************************************************************************************
2025-08-13 16:49:45,354 p=4377 u=runner n=ansible INFO| localhost                  : ok=17   changed=2    unreachable=0    failed=0    skipped=2    rescued=0    ignored=1   
